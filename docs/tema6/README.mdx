import CodeBlock from '@theme/CodeBlock';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Tema 6 - Acceso a ficheros en Java

En este tema veremos cómo acceder a ficheros en Java, cómo leer y escribir en ellos y cómo trabajar con ficheros de texto y binarios.

También aprenderemos sobre la serialización de objetos y el uso de ficheros de propiedades.

## Apuntes y ejemplos

1. [Ficheros en Java](./0_Ficheros.mdx)
2. [Serialización de objetos](./1_Serializacion.mdx)
3. [Ficheros de propiedades](./2_Ficheros_Properties.mdx)

## Ejercicios

### Ejercicio 1 - Gestión de Usuarios en un fichero

Realiza un programa en Java que permita gestionar un fichero de usuarios llamado ``usuarios.txt``. El programa deberá hacer lo siguiente:

1. Al iniciar, verificar si el fichero usuarios.txt existe:

    - Si no existe, crearlo vacío.

2. Mostrar un menú en consola con las siguientes opciones:

```
1. Añadir nuevo usuario
2. Mostrar todos los usuarios
3. Buscar usuario por nombre
4. Salir
```

3. Los usuarios se deben almacenar en el fichero con el siguiente formato por cada línea:

```plaintext
Nombre,Edad,Ciudad
```

> Ejemplo de fichero:

```plaintext	
Carlos,30,Madrid
Laura,25,Barcelona
Ana,40,Valencia
```

- La opción "Añadir nuevo usuario" debe pedir al usuario que introduzca su nombre, edad y ciudad, y añadir esa información al final del fichero.

- La opción "Mostrar todos los usuarios" debe leer el fichero y mostrar todos los registros de usuarios con un formato claro:

```yaml
Nombre: Carlos | Edad: 30 | Ciudad: Madrid
...
```

- La opción "Buscar usuario por nombre" debe pedir un nombre y buscar coincidencias en el fichero. Si lo encuentra, debe mostrar sus datos. Si no lo encuentra, indicar que no existe.

- La opción "Salir" termina el programa.

<details>
<summary>Ver Solución</summary>
    <Tabs defaultValue="gestionusuarios" groupId="ejercicio-1" values={[
        {label: 'GestionUsuarios.java', value: 'gestionusuarios',},
    ]}>
        <TabItem value="gestionusuarios">
```java
import java.io.*;
import java.util.Scanner;

public class GestionUsuarios {
    private static final String NOMBRE_FICHERO = "usuarios.txt";

    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);

        // Comprobar si existe el fichero, sino crearlo
        File fichero = new File(NOMBRE_FICHERO);
        try {
            if (fichero.createNewFile()) {
                System.out.println("El fichero 'usuarios.txt' ha sido creado.");
            } else {
                System.out.println("El fichero 'usuarios.txt' ya existe.");
            }
        } catch (IOException e) {
            System.out.println("Error al crear el fichero.");
            return;
        }

        int opcion;
        do {
            mostrarMenu();
            opcion = sc.nextInt();
            sc.nextLine(); // Limpiar buffer

            switch (opcion) {
                case 1:
                    anadirUsuario(sc);
                    break;
                case 2:
                    mostrarUsuarios();
                    break;
                case 3:
                    buscarUsuario(sc);
                    break;
                case 4:
                    System.out.println("Saliendo del programa...");
                    break;
                default:
                    System.out.println("Opción no válida.");
            }
        } while (opcion != 4);
    }

    private static void mostrarMenu() {
        System.out.println("\n--- Menú de Gestión de Usuarios ---");
        System.out.println("1. Añadir nuevo usuario");
        System.out.println("2. Mostrar todos los usuarios");
        System.out.println("3. Buscar usuario por nombre");
        System.out.println("4. Salir");
        System.out.print("Seleccione una opción: ");
    }

    private static void anadirUsuario(Scanner sc) {
        System.out.print("Introduce el nombre: ");
        String nombre = sc.nextLine();

        System.out.print("Introduce la edad: ");
        int edad = sc.nextInt();
        sc.nextLine(); // Limpiar buffer

        System.out.print("Introduce la ciudad: ");
        String ciudad = sc.nextLine();

        try (FileWriter writer = new FileWriter(NOMBRE_FICHERO, true)) {
            writer.write(nombre + "," + edad + "," + ciudad + "\n");
            System.out.println("Usuario añadido correctamente.");
        } catch (IOException e) {
            System.out.println("Error al escribir en el fichero.");
        }
    }

    private static void mostrarUsuarios() {
        try (BufferedReader reader = new BufferedReader(new FileReader(NOMBRE_FICHERO))) {
            String linea;
            System.out.println("\n--- Lista de Usuarios ---");

            boolean ficheroVacio = true;
            while ((linea = reader.readLine()) != null) {
                ficheroVacio = false;
                String[] datos = linea.split(",");
                System.out.println("Nombre: " + datos[0] + " | Edad: " + datos[1] + " | Ciudad: " + datos[2]);
            }

            if (ficheroVacio) {
                System.out.println("El fichero está vacío.");
            }

        } catch (IOException e) {
            System.out.println("Error al leer el fichero.");
        }
    }

    private static void buscarUsuario(Scanner sc) {
        System.out.print("Introduce el nombre a buscar: ");
        String nombreBuscar = sc.nextLine();

        boolean encontrado = false;

        try (BufferedReader reader = new BufferedReader(new FileReader(NOMBRE_FICHERO))) {
            String linea;

            while ((linea = reader.readLine()) != null) {
                String[] datos = linea.split(",");
                String nombre = datos[0];

                if (nombre.equalsIgnoreCase(nombreBuscar)) {
                    System.out.println("Usuario encontrado:");
                    System.out.println("Nombre: " + datos[0] + " | Edad: " + datos[1] + " | Ciudad: " + datos[2]);
                    encontrado = true;
                }
            }

            if (!encontrado) {
                System.out.println("Usuario no encontrado.");
            }

        } catch (IOException e) {
            System.out.println("Error al leer el fichero.");
        }
    }
}
```
        </TabItem>
    </Tabs>
</details>

### Ejercicio 2 - Sistema de Log de Usuarios

Realiza un programa en Java que simule un sistema de logs para registrar los eventos de inicio de sesión (login) y cierre de sesión (logout) de los usuarios del sistema.

El programa debe funcionar de la siguiente manera:

1. Comprobar existencia del fichero log:
    - El fichero se llamará log_usuarios.txt.

    - Si no existe, debe crearse automáticamente.

2. Mostrar menú con las siguientes opciones:

```
1. Login de usuario
2. Logout de usuario
3. Mostrar log completo
4. Salir
```

Detalles de funcionamiento:
- Opción 1 — Login:

    - Pedir el nombre de usuario.

    - Escribir en el fichero una línea con el siguiente formato:

```plaintext
[Fecha - Hora] LOGIN -> Usuario: nombre_usuario
```

> Ejemplo:
```yaml
[2025-04-07 15:22:10] LOGIN -> Usuario: Carlos
```

- Opción 2 — Logout:

    - Pedir el nombre de usuario.

    - Escribir en el fichero una línea con el siguiente formato:

```plaintext
[Fecha - Hora] LOGOUT -> Usuario: nombre_usuario
```

- Opción 3 — Mostrar log completo:

    - Leer el fichero y mostrar todas las líneas en consola.


**Requisitos adicionales:**

- Utilizar la clase LocalDateTime y DateTimeFormatter de Java para formatear la fecha y la hora.
- Usar FileWriter en modo append para no sobrescribir el fichero.
- Manejar posibles excepciones con try-catch.
- Organizar el código en métodos separados.

<details>
<summary>Ver Solución</summary>
    <Tabs defaultValue="logusuarios" groupId="ejercicio-2" values={[
        {label: 'LogUsuarios.java', value: 'logusuarios',},
    ]}>
        <TabItem value="logusuarios">
```java
import java.io.*;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Scanner;

public class LogUsuarios {
    private static final String NOMBRE_FICHERO_LOG = "log_usuarios.txt";
    private static final DateTimeFormatter FORMATO_FECHA = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");

    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);

        File ficheroLog = new File(NOMBRE_FICHERO_LOG);
        try {
            if (ficheroLog.createNewFile()) {
                System.out.println("El fichero 'log_usuarios.txt' ha sido creado.");
            } else {
                System.out.println("El fichero 'log_usuarios.txt' ya existe.");
            }
        } catch (IOException e) {
            System.out.println("Error al crear el fichero de log.");
            return;
        }

        int opcion;
        do {
            mostrarMenu();
            opcion = sc.nextInt();
            sc.nextLine(); // Limpiar buffer

            switch (opcion) {
                case 1:
                    registrarEvento(sc, "LOGIN");
                    break;
                case 2:
                    registrarEvento(sc, "LOGOUT");
                    break;
                case 3:
                    mostrarLog();
                    break;
                case 4:
                    System.out.println("Saliendo del programa...");
                    break;
                default:
                    System.out.println("Opción no válida.");
            }
        } while (opcion != 4);
    }

    private static void mostrarMenu() {
        System.out.println("\n--- Menú de Registro de Logs ---");
        System.out.println("1. Login de usuario");
        System.out.println("2. Logout de usuario");
        System.out.println("3. Mostrar log completo");
        System.out.println("4. Salir");
        System.out.print("Seleccione una opción: ");
    }

    private static void registrarEvento(Scanner sc, String tipoEvento) {
        System.out.print("Introduce el nombre del usuario: ");
        String nombreUsuario = sc.nextLine();

        String fechaHora = LocalDateTime.now().format(FORMATO_FECHA);
        String lineaLog = "[" + fechaHora + "] " + tipoEvento + " -> Usuario: " + nombreUsuario;

        try (FileWriter writer = new FileWriter(NOMBRE_FICHERO_LOG, true)) {
            writer.write(lineaLog + "\n");
            System.out.println("Evento registrado correctamente.");
        } catch (IOException e) {
            System.out.println("Error al escribir en el fichero de log.");
        }
    }

    private static void mostrarLog() {
        System.out.println("\n--- Contenido del Fichero de Log ---");

        try (BufferedReader reader = new BufferedReader(new FileReader(NOMBRE_FICHERO_LOG))) {
            String linea;
            boolean ficheroVacio = true;

            while ((linea = reader.readLine()) != null) {
                ficheroVacio = false;
                System.out.println(linea);
            }

            if (ficheroVacio) {
                System.out.println("El fichero de log está vacío.");
            }

        } catch (IOException e) {
            System.out.println("Error al leer el fichero de log.");
        }
    }
}
```
        </TabItem>
    </Tabs>
</details>

### Ejercicio 3 - Sistema de Gestión de Notas de Estudiantes (con múltiples ficheros)

Realiza un programa en Java que permita gestionar un sistema de notas de estudiantes, utilizando varios ficheros de texto.

El sistema debe trabajar con:

Ficheros:
1. ``estudiantes.txt`` → Contiene el listado de estudiantes registrados.

2. ``notas_nombreEstudiante.txt`` → Para cada estudiante se creará un fichero individual con sus notas registradas.

Funcionamiento del programa:
1. Mostrar menú principal:
    
```
1. Registrar nuevo estudiante
2. Añadir nota a un estudiante
3. Mostrar notas de un estudiante
4. Mostrar todos los estudiantes
5. Salir
```

**Opción 1 — Registrar nuevo estudiante:**

- Pedir el nombre del estudiante.

- Comprobar que no exista ya en ``estudiantes.txt``.

- Si no existe:

    - Añadir el nombre al fichero ``estudiantes.txt``.

    - Crear un fichero nuevo vacío llamado ``notas_nombreEstudiante.txt``.

**Opción 2 — Añadir nota a un estudiante:**

- Mostrar listado de estudiantes.

- Pedir el nombre.

- Si existe su fichero de notas:

    - Pedir una nota (entre 0 y 10).

    - Escribir la nota en su fichero.

**Opción 3 — Mostrar notas de un estudiante:**

- Mostrar listado de estudiantes.

- Pedir nombre.

- Leer y mostrar el contenido del fichero de notas.

**Opción 4 — Mostrar todos los estudiantes:**

- Leer y mostrar el contenido de ``estudiantes.txt``.

**Requisitos adicionales:**

- Crear los ficheros automáticamente si no existen.

- Comprobar existencia de estudiantes y ficheros antes de operar.

- Utilizar ``BufferedReader``, ``BufferedWriter`` y ``FileWriter``.

- Manejar excepciones correctamente.

<details>
<summary>Ver Solución</summary>
    <Tabs defaultValue="gestionnotas" groupId="ejercicio-3" values={[
        {label: 'GestionNotas.java', value: 'gestionnotas',},
    ]}>
        <TabItem value="gestionnotas">
```java
import java.io.*;
import java.util.Scanner;

public class GestionNotas {
    private static final String FICHERO_ESTUDIANTES = "estudiantes.txt";

    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);

        crearFicheroSiNoExiste(FICHERO_ESTUDIANTES);

        int opcion;
        do {
            mostrarMenu();
            opcion = sc.nextInt();
            sc.nextLine(); // limpiar buffer

            switch (opcion) {
                case 1:
                    registrarEstudiante(sc);
                    break;
                case 2:
                    anadirNota(sc);
                    break;
                case 3:
                    mostrarNotasEstudiante(sc);
                    break;
                case 4:
                    mostrarTodosLosEstudiantes();
                    break;
                case 5:
                    System.out.println("Saliendo del programa...");
                    break;
                default:
                    System.out.println("Opción no válida.");
            }
        } while (opcion != 5);
    }

    private static void mostrarMenu() {
        System.out.println("\n--- Menú Gestión de Notas ---");
        System.out.println("1. Registrar nuevo estudiante");
        System.out.println("2. Añadir nota a un estudiante");
        System.out.println("3. Mostrar notas de un estudiante");
        System.out.println("4. Mostrar todos los estudiantes");
        System.out.println("5. Salir");
        System.out.print("Seleccione una opción: ");
    }

    private static void registrarEstudiante(Scanner sc) {
        System.out.print("Introduce el nombre del nuevo estudiante: ");
        String nombre = sc.nextLine();

        if (existeEstudiante(nombre)) {
            System.out.println("El estudiante ya está registrado.");
        } else {
            try (FileWriter fw = new FileWriter(FICHERO_ESTUDIANTES, true)) {
                fw.write(nombre + "\n");
                crearFicheroSiNoExiste("notas_" + nombre + ".txt");
                System.out.println("Estudiante registrado correctamente.");
            } catch (IOException e) {
                System.out.println("Error al registrar el estudiante.");
            }
        }
    }

    private static boolean existeEstudiante(String nombre) {
        try (BufferedReader br = new BufferedReader(new FileReader(FICHERO_ESTUDIANTES))) {
            String linea;
            while ((linea = br.readLine()) != null) {
                if (linea.equalsIgnoreCase(nombre)) {
                    return true;
                }
            }
        } catch (IOException e) {
            System.out.println("Error al comprobar estudiante.");
        }
        return false;
    }

    private static void anadirNota(Scanner sc) {
        mostrarTodosLosEstudiantes();
        System.out.print("Introduce el nombre del estudiante: ");
        String nombre = sc.nextLine();

        if (!existeEstudiante(nombre)) {
            System.out.println("El estudiante no existe.");
            return;
        }

        System.out.print("Introduce la nota (0-10): ");
        double nota = sc.nextDouble();
        sc.nextLine(); // limpiar buffer

        if (nota < 0 || nota > 10) {
            System.out.println("Nota fuera de rango.");
            return;
        }

        String ficheroNotas = "notas_" + nombre + ".txt";

        try (FileWriter fw = new FileWriter(ficheroNotas, true)) {
            fw.write(nota + "\n");
            System.out.println("Nota añadida correctamente.");
        } catch (IOException e) {
            System.out.println("Error al añadir la nota.");
        }
    }

    private static void mostrarNotasEstudiante(Scanner sc) {
        mostrarTodosLosEstudiantes();
        System.out.print("Introduce el nombre del estudiante: ");
        String nombre = sc.nextLine();

        if (!existeEstudiante(nombre)) {
            System.out.println("El estudiante no existe.");
            return;
        }

        String ficheroNotas = "notas_" + nombre + ".txt";

        System.out.println("\nNotas de " + nombre + ":");

        try (BufferedReader br = new BufferedReader(new FileReader(ficheroNotas))) {
            String linea;
            boolean ficheroVacio = true;
            while ((linea = br.readLine()) != null) {
                ficheroVacio = false;
                System.out.println("Nota: " + linea);
            }

            if (ficheroVacio) {
                System.out.println("No hay notas registradas.");
            }

        } catch (IOException e) {
            System.out.println("Error al leer las notas.");
        }
    }

    private static void mostrarTodosLosEstudiantes() {
        System.out.println("\nListado de estudiantes:");

        try (BufferedReader br = new BufferedReader(new FileReader(FICHERO_ESTUDIANTES))) {
            String linea;
            boolean ficheroVacio = true;
            while ((linea = br.readLine()) != null) {
                ficheroVacio = false;
                System.out.println("- " + linea);
            }

            if (ficheroVacio) {
                System.out.println("No hay estudiantes registrados.");
            }

        } catch (IOException e) {
            System.out.println("Error al leer el fichero de estudiantes.");
        }
    }

    private static void crearFicheroSiNoExiste(String nombreFichero) {
        File fichero = new File(nombreFichero);
        try {
            if (fichero.createNewFile()) {
                System.out.println("Fichero creado: " + nombreFichero);
            }
        } catch (IOException e) {
            System.out.println("Error al crear el fichero: " + nombreFichero);
        }
    }
}
```
        </TabItem>
    </Tabs>
</details>

### Ejercicio 4 - Gestor de tareas con eliminación y copias de seguridad

Crea un programa en Java llamado **GestorTareas** que permita gestionar un listado de tareas pendientes.

El programa trabajará con un fichero llamado ``tareas.txt`` donde cada línea representa una tarea registrada por el usuario.

Formato de cada línea en el fichero:

```plaintext
ID_TAREA | Descripción de la tarea
```

**Requisitos:**

1. Mostrar un menú con las siguientes opciones:

- Añadir nueva tarea.

- Mostrar todas las tareas.

- Eliminar una tarea específica (por ID).

- Crear una copia de seguridad del fichero de tareas.

- Salir del programa.

2. Antes de eliminar una tarea:

- Mostrar las tareas actuales.

- Pedir el ID de la tarea a eliminar.

- Eliminar solo la línea correspondiente al ID introducido.

- El resto de las tareas deben permanecer intactas.

3. Al crear una copia de seguridad:

- Copiar el contenido de ``tareas.txt`` a un nuevo fichero llamado ``tareas_backup_fecha.txt``.

- El nombre del backup debe incluir la fecha y hora actual (por ejemplo: ``tareas_backup_2025-04-07_18-30.txt``).

4. Si el fichero ``tareas.txt`` no existe, debe crearse automáticamente.

<details>
<summary>Ver Solución</summary>
    <Tabs defaultValue="gestortareas" groupId="ejercicio-4" values={[
        {label: 'GestorTareas.java (usando Files)', value: 'gestortareas',},
        {label: 'GestorTareasClasico.java (usando File)', value: 'gestortareasclasico',},

    ]}>
        <TabItem value="gestortareas">

```java
import java.io.IOException;
import java.nio.file.*;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.*;
import java.util.stream.Collectors;

public class GestorTareas {

    private static final String FICHERO_TAREAS = "tareas.txt";
    private static final Path PATH_TAREAS = Paths.get(FICHERO_TAREAS);
    private static final Scanner sc = new Scanner(System.in);

    public static void main(String[] args) {
        crearFicheroSiNoExiste();

        int opcion;
        do {
            mostrarMenu();
            opcion = sc.nextInt();
            sc.nextLine(); // Limpiar buffer

            switch (opcion) {
                case 1:
                    anadirTarea();
                    break;
                case 2:
                    mostrarTareas();
                    break;
                case 3:
                    eliminarTarea();
                    break;
                case 4:
                    crearCopiaSeguridad();
                    break;
                case 5:
                    System.out.println("Saliendo del programa...");
                    break;
                default:
                    System.out.println("Opción no válida.");
            }
        } while (opcion != 5);
    }

    private static void mostrarMenu() {
        System.out.println("\n--- Menú Gestor de Tareas ---");
        System.out.println("1. Añadir nueva tarea");
        System.out.println("2. Mostrar todas las tareas");
        System.out.println("3. Eliminar tarea por ID");
        System.out.println("4. Crear copia de seguridad");
        System.out.println("5. Salir");
        System.out.print("Seleccione una opción: ");
    }

    private static void crearFicheroSiNoExiste() {
        try {
            if (Files.notExists(PATH_TAREAS)) {
                Files.createFile(PATH_TAREAS);
                System.out.println("Fichero de tareas creado.");
            }
        } catch (IOException e) {
            System.out.println("Error al crear el fichero de tareas.");
        }
    }

    private static void anadirTarea() {
        System.out.print("Introduce la descripción de la tarea: ");
        String descripcion = sc.nextLine();

        int nuevoId = obtenerSiguienteID();

        String linea = nuevoId + " | " + descripcion;

        try {
            Files.write(PATH_TAREAS, Arrays.asList(linea), StandardOpenOption.APPEND);
            System.out.println("Tarea añadida correctamente.");
        } catch (IOException e) {
            System.out.println("Error al añadir tarea.");
        }
    }

    private static int obtenerSiguienteID() {
        try {
            List<String> lineas = Files.readAllLines(PATH_TAREAS);
            int maxId = 0;

            for (String linea : lineas) {
                String[] partes = linea.split("\\|");
                int id = Integer.parseInt(partes[0].trim());
                if (id > maxId) {
                    maxId = id;
                }
            }

            return maxId + 1;

        } catch (IOException e) {
            System.out.println("Error al obtener ID.");
            return 1;
        }
    }

    private static void mostrarTareas() {
        System.out.println("\nListado de Tareas:");

        try {
            List<String> lineas = Files.readAllLines(PATH_TAREAS);

            if (lineas.isEmpty()) {
                System.out.println("No hay tareas registradas.");
            } else {
                lineas.forEach(System.out::println);
            }

        } catch (IOException e) {
            System.out.println("Error al leer las tareas.");
        }
    }

    private static void eliminarTarea() {
        mostrarTareas();

        System.out.print("Introduce el ID de la tarea a eliminar: ");
        int idEliminar = sc.nextInt();
        sc.nextLine(); // Limpiar buffer

        try {
            List<String> lineas = Files.readAllLines(PATH_TAREAS);

            List<String> nuevasLineas = lineas.stream()
                    .filter(linea -> {
                        String[] partes = linea.split("\\|");
                        int id = Integer.parseInt(partes[0].trim());
                        return id != idEliminar;
                    })
                    .collect(Collectors.toList());

            Files.write(PATH_TAREAS, nuevasLineas, StandardOpenOption.TRUNCATE_EXISTING);

            System.out.println("Tarea eliminada correctamente (si existía).");

        } catch (IOException e) {
            System.out.println("Error al eliminar tarea.");
        }
    }

    private static void crearCopiaSeguridad() {
        DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd_HH-mm");
        String fechaHora = LocalDateTime.now().format(formatter);

        String nombreBackup = "tareas_backup_" + fechaHora + ".txt";
        Path pathBackup = Paths.get(nombreBackup);

        try {
            Files.copy(PATH_TAREAS, pathBackup, StandardCopyOption.REPLACE_EXISTING);
            System.out.println("Copia de seguridad creada: " + nombreBackup);
        } catch (IOException e) {
            System.out.println("Error al crear la copia de seguridad.");
        }
    }
}
```
        </TabItem>
        <TabItem value="gestortareasclasico">
```java
import java.io.*;
import java.text.SimpleDateFormat;
import java.util.*;

public class GestorTareasClasico {

    private static final String FICHERO_TAREAS = "tareas.txt";
    private static final Scanner sc = new Scanner(System.in);

    public static void main(String[] args) {
        crearFicheroSiNoExiste();

        int opcion;
        do {
            mostrarMenu();
            opcion = sc.nextInt();
            sc.nextLine(); // Limpiar buffer

            switch (opcion) {
                case 1:
                    anadirTarea();
                    break;
                case 2:
                    mostrarTareas();
                    break;
                case 3:
                    eliminarTarea();
                    break;
                case 4:
                    crearCopiaSeguridad();
                    break;
                case 5:
                    System.out.println("Saliendo del programa...");
                    break;
                default:
                    System.out.println("Opción no válida.");
            }
        } while (opcion != 5);
    }

    private static void mostrarMenu() {
        System.out.println("\n--- Menú Gestor de Tareas ---");
        System.out.println("1. Añadir nueva tarea");
        System.out.println("2. Mostrar todas las tareas");
        System.out.println("3. Eliminar tarea por ID");
        System.out.println("4. Crear copia de seguridad");
        System.out.println("5. Salir");
        System.out.print("Seleccione una opción: ");
    }

    private static void crearFicheroSiNoExiste() {
        File fichero = new File(FICHERO_TAREAS);
        if (!fichero.exists()) {
            try {
                fichero.createNewFile();
                System.out.println("Fichero de tareas creado.");
            } catch (IOException e) {
                System.out.println("Error al crear el fichero.");
            }
        }
    }

    private static void anadirTarea() {
        System.out.print("Introduce la descripción de la tarea: ");
        String descripcion = sc.nextLine();
        int nuevoId = obtenerSiguienteID();

        try (FileWriter fw = new FileWriter(FICHERO_TAREAS, true);
             PrintWriter pw = new PrintWriter(fw)) {

            pw.println(nuevoId + " | " + descripcion);
            System.out.println("Tarea añadida correctamente.");

        } catch (IOException e) {
            System.out.println("Error al escribir la tarea.");
        }
    }

    private static int obtenerSiguienteID() {
        int maxId = 0;

        try (BufferedReader br = new BufferedReader(new FileReader(FICHERO_TAREAS))) {
            String linea;
            while ((linea = br.readLine()) != null) {
                String[] partes = linea.split("\\|");
                int id = Integer.parseInt(partes[0].trim());
                if (id > maxId) {
                    maxId = id;
                }
            }
        } catch (IOException e) {
            System.out.println("Error al leer las tareas.");
        }

        return maxId + 1;
    }

    private static void mostrarTareas() {
        System.out.println("\nListado de Tareas:");

        try (BufferedReader br = new BufferedReader(new FileReader(FICHERO_TAREAS))) {
            String linea;
            boolean hayTareas = false;
            while ((linea = br.readLine()) != null) {
                System.out.println(linea);
                hayTareas = true;
            }
            if (!hayTareas) {
                System.out.println("No hay tareas registradas.");
            }
        } catch (IOException e) {
            System.out.println("Error al leer las tareas.");
        }
    }

    private static void eliminarTarea() {
        mostrarTareas();

        System.out.print("Introduce el ID de la tarea a eliminar: ");
        int idEliminar = sc.nextInt();
        sc.nextLine(); // Limpiar buffer

        File ficheroOriginal = new File(FICHERO_TAREAS);
        File ficheroTemporal = new File("tareas_temp.txt");

        try (BufferedReader br = new BufferedReader(new FileReader(ficheroOriginal));
             PrintWriter pw = new PrintWriter(new FileWriter(ficheroTemporal))) {

            String linea;
            while ((linea = br.readLine()) != null) {
                String[] partes = linea.split("\\|");
                int id = Integer.parseInt(partes[0].trim());

                if (id != idEliminar) {
                    pw.println(linea);
                }
            }

        } catch (IOException e) {
            System.out.println("Error al eliminar la tarea.");
        }

        if (ficheroOriginal.delete()) {
            ficheroTemporal.renameTo(ficheroOriginal);
            System.out.println("Tarea eliminada correctamente (si existía).");
        } else {
            System.out.println("Error al actualizar el fichero.");
        }
    }

    private static void crearCopiaSeguridad() {
        String fechaHora = new SimpleDateFormat("yyyy-MM-dd_HH-mm").format(new Date());
        String nombreBackup = "tareas_backup_" + fechaHora + ".txt";

        File ficheroOriginal = new File(FICHERO_TAREAS);
        File ficheroBackup = new File(nombreBackup);

        try (BufferedReader br = new BufferedReader(new FileReader(ficheroOriginal));
             PrintWriter pw = new PrintWriter(new FileWriter(ficheroBackup))) {

            String linea;
            while ((linea = br.readLine()) != null) {
                pw.println(linea);
            }

            System.out.println("Copia de seguridad creada: " + nombreBackup);

        } catch (IOException e) {
            System.out.println("Error al crear la copia de seguridad.");
        }
    }
}
```
        </TabItem>
    </Tabs> 
</details>

### Ejercicio 5 - Gestión de Biblioteca con Serialización de Objetos

Desarrolla una aplicación en Java que gestione una biblioteca de libros. Cada libro tendrá:

- Código único (String)

- Título (String)

- Autor (String)

- Año de publicación (int)

Funcionalidades que debe tener el programa:
1. Añadir un nuevo libro a la biblioteca.

2. Listar todos los libros guardados.

3. Buscar un libro por su código.

4. Eliminar un libro por su código.

5. Guardar y cargar todos los libros usando serialización y deserialización de objetos.

Requisitos:
- Los libros se deben almacenar en un fichero binario llamado biblioteca.dat usando ObjectOutputStream y ObjectInputStream.

- Cada vez que se añada, elimine o modifique un libro, se debe sobrescribir el fichero completo serializando de nuevo la lista de libros.

- Al iniciar el programa, debe cargarse el fichero biblioteca.dat si existe.

- Si se elimina un libro, debe deserializar la lista, eliminar el objeto correspondiente, y volver a serializar la lista actualizada.

Estructura de Clases recomendada:
- Libro.java → Clase que representa un libro (Serializable).

- Biblioteca.java → Clase que gestiona los libros y el fichero.

- Main.java → Clase principal con menú de opciones.

<details>
<summary>Ver Solución</summary>
    <Tabs defaultValue="libro" groupId="ejercicio-5" values={[
        {label: 'Libro.java', value: 'libro',},
        {label: 'Biblioteca.java', value: 'biblioteca',},
        {label: 'Main.java', value: 'main',},
    ]}>
        <TabItem value="libro">

```java
import java.io.Serializable;

public class Libro implements Serializable {
    private String codigo;
    private String titulo;
    private String autor;
    private int anioPublicacion;

    public Libro(String codigo, String titulo, String autor, int anioPublicacion) {
        this.codigo = codigo;
        this.titulo = titulo;
        this.autor = autor;
        this.anioPublicacion = anioPublicacion;
    }

    public String getCodigo() {
        return codigo;
    }

    @Override
    public String toString() {
        return "Código: " + codigo + ", Título: " + titulo + ", Autor: " + autor + ", Año: " + anioPublicacion;
    }
}
```
        </TabItem>
        <TabItem value="biblioteca">
```java
import java.io.*;
import java.util.ArrayList;
import java.util.List;

public class Biblioteca {
    private List<Libro> libros;
    private final String nombreFichero = "biblioteca.dat";

    public Biblioteca() {
        libros = cargarLibros();
    }

    private List<Libro> cargarLibros() {
        List<Libro> lista = new ArrayList<>();
        File fichero = new File(nombreFichero);

        if (fichero.exists()) {
            try (ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fichero))) {
                lista = (List<Libro>) ois.readObject();
            } catch (IOException | ClassNotFoundException e) {
                System.out.println("Error al cargar libros: " + e.getMessage());
            }
        }

        return lista;
    }

    private void guardarLibros() {
        try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(nombreFichero))) {
            oos.writeObject(libros);
        } catch (IOException e) {
            System.out.println("Error al guardar libros: " + e.getMessage());
        }
    }

    public void añadirLibro(Libro libro) {
        libros.add(libro);
        guardarLibros();
        System.out.println("Libro añadido correctamente.");
    }

    public void listarLibros() {
        if (libros.isEmpty()) {
            System.out.println("No hay libros en la biblioteca.");
        } else {
            for (Libro l : libros) {
                System.out.println(l);
            }
        }
    }

    public void buscarLibro(String codigo) {
        for (Libro l : libros) {
            if (l.getCodigo().equalsIgnoreCase(codigo)) {
                System.out.println("Libro encontrado: " + l);
                return;
            }
        }
        System.out.println("Libro no encontrado.");
    }

    public void eliminarLibro(String codigo) {
        boolean eliminado = libros.removeIf(l -> l.getCodigo().equalsIgnoreCase(codigo));
        if (eliminado) {
            guardarLibros();
            System.out.println("Libro eliminado correctamente.");
        } else {
            System.out.println("Libro no encontrado.");
        }
    }
}
```
        </TabItem>
        <TabItem value="main">
```java
import java.util.Scanner;

public class Main {
    public static void main(String[] args) {
        Biblioteca biblioteca = new Biblioteca();
        Scanner sc = new Scanner(System.in);
        int opcion;

        do {
            System.out.println("\n--- Menú Biblioteca ---");
            System.out.println("1. Añadir libro");
            System.out.println("2. Listar libros");
            System.out.println("3. Buscar libro por código");
            System.out.println("4. Eliminar libro por código");
            System.out.println("5. Salir");
            System.out.print("Seleccione una opción: ");
            opcion = sc.nextInt();
            sc.nextLine();

            switch (opcion) {
                case 1:
                    System.out.print("Código: ");
                    String codigo = sc.nextLine();
                    System.out.print("Título: ");
                    String titulo = sc.nextLine();
                    System.out.print("Autor: ");
                    String autor = sc.nextLine();
                    System.out.print("Año de publicación: ");
                    int anio = sc.nextInt();
                    sc.nextLine();

                    Libro libro = new Libro(codigo, titulo, autor, anio);
                    biblioteca.añadirLibro(libro);
                    break;
                case 2:
                    biblioteca.listarLibros();
                    break;
                case 3:
                    System.out.print("Código del libro a buscar: ");
                    String codBuscar = sc.nextLine();
                    biblioteca.buscarLibro(codBuscar);
                    break;
                case 4:
                    System.out.print("Código del libro a eliminar: ");
                    String codEliminar = sc.nextLine();
                    biblioteca.eliminarLibro(codEliminar);
                    break;
                case 5:
                    System.out.println("Saliendo del programa...");
                    break;
                default:
                    System.out.println("Opción no válida.");
            }
        } while (opcion != 5);
    }
}
```
        </TabItem>
    </Tabs>
</details>

### Ejercicio 6 - Gestión de Configuración de una Aplicación con Java Properties 

Desarrollar una aplicación Java que gestione la configuración de una aplicación usando un fichero ``config.properties``.

El programa debe permitir:

1. Crear el fichero config.properties (si no existe) con las siguientes propiedades por defecto:

| Propiedad | Valor por defecto |
|-----------|------------------|
| idioma | es |
| tema | claro |
| tamaño_fuente | 12 |
| mostrar_tutorial | true |

2. Leer las propiedades actuales del fichero y mostrarlas al usuario.

3. Modificar culquier propiedad y guardar los cambios en el fichero ``config.properties``.

4. Restaurar los valores por defecto. 

Requisitos:

- El fichero ``config.properties`` debe almacenarse en el directorio raíz del proyecto.

- Debes usar la clase ``Properties`` de Java (``java.util.Properties``).

- Debes usar ``Properties.load()`` para leer las propiedades y ``Properties.store()`` para guardarlas.

<details>
<summary>Ver Solución</summary>
    <Tabs defaultValue="configuracion" groupId="ejercicio-6" values={[
        {label: 'Configuracion.java', value: 'configuracion',},
        {label: 'Main.java', value: 'main',},
        {label: 'config.properties (ejemplo)', value: 'configproperties',},
    ]}>
        <TabItem value="configuracion">
```java
import java.io.*;
import java.util.Properties;

public class Configuracion {
    private final String nombreFichero = "config.properties";
    private Properties propiedades;

    public Configuracion() {
        propiedades = new Properties();
        cargarPropiedades();
    }

    private void cargarPropiedades() {
        File fichero = new File(nombreFichero);

        if (!fichero.exists()) {
            crearPropiedadesPorDefecto();
        }

        try (FileInputStream fis = new FileInputStream(fichero)) {
            propiedades.load(fis);
        } catch (IOException e) {
            System.out.println("Error al cargar el fichero de configuración: " + e.getMessage());
        }
    }

    private void crearPropiedadesPorDefecto() {
        propiedades.setProperty("idioma", "español");
        propiedades.setProperty("tema", "claro");
        propiedades.setProperty("tamaño_fuente", "14");
        propiedades.setProperty("mostrar_tutorial", "true");

        guardarPropiedades();
    }

    public void mostrarPropiedades() {
        System.out.println("\nConfiguración actual:");
        propiedades.forEach((k, v) -> System.out.println(k + ": " + v));
    }

    public void modificarPropiedad(String clave, String valor) {
        if (propiedades.containsKey(clave)) {
            propiedades.setProperty(clave, valor);
            guardarPropiedades();
            System.out.println("Propiedad modificada correctamente.");
        } else {
            System.out.println("La propiedad indicada no existe.");
        }
    }

    public void restaurarPorDefecto() {
        crearPropiedadesPorDefecto();
        System.out.println("Propiedades restauradas a los valores por defecto.");
    }

    private void guardarPropiedades() {
        try (FileOutputStream fos = new FileOutputStream(nombreFichero)) {
            propiedades.store(fos, "Configuración de la Aplicación");
        } catch (IOException e) {
            System.out.println("Error al guardar las propiedades: " + e.getMessage());
        }
    }
}
```
        </TabItem>
        <TabItem value="main">
```java
import java.util.Scanner;

public class Main {
    public static void main(String[] args) {
        Configuracion configuracion = new Configuracion();
        Scanner sc = new Scanner(System.in);
        int opcion;

        do {
            System.out.println("\n--- Menú de Configuración ---");
            System.out.println("1. Mostrar configuración actual");
            System.out.println("2. Modificar propiedad");
            System.out.println("3. Restaurar configuración por defecto");
            System.out.println("4. Salir");
            System.out.print("Seleccione una opción: ");
            opcion = sc.nextInt();
            sc.nextLine();

            switch (opcion) {
                case 1:
                    configuracion.mostrarPropiedades();
                    break;
                case 2:
                    System.out.print("Ingrese el nombre de la propiedad a modificar: ");
                    String clave = sc.nextLine();
                    System.out.print("Ingrese el nuevo valor: ");
                    String valor = sc.nextLine();
                    configuracion.modificarPropiedad(clave, valor);
                    break;
                case 3:
                    configuracion.restaurarPorDefecto();
                    break;
                case 4:
                    System.out.println("Saliendo del programa...");
                    break;
                default:
                    System.out.println("Opción no válida.");
            }
        } while (opcion != 4);
    }
}
```
        </TabItem>
        <TabItem value="configproperties">
```properties
#Configuración de la Aplicación
#Mon Apr 08 17:36:45 CEST 2025
idioma=es
tema=claro
tamaño_fuente=14
mostrar_tutorial=true
```
        </TabItem>
    </Tabs>
</details>

### Ejercicio 7 - Gestión de Inventario de Productos usando Ficheros CSV (Coma Separeted Values)

Desarrollar un programa en Java que gestione un inventario de productos de una tienda utilizando un fichero CSV llamado productos.csv.

Cada producto tendrá la siguiente información:

| Campo | Descripción |
|-------|-------------|
| ID | Identificador único del producto |
| Nombre | Nombre del producto |
| Precio | Precio del producto en euros (€) |
| Stock | Cantidad disponible |

Requisitos del programa:

1. Crear el fichero ``productos.csv`` si no existe con algunos productos iniciales.

Ejemplo de contenido:

```csv
1;Manzana;0.50;100
2;Leche;1.20;50
3;Pan;0.80;75
4;Arroz;1.50;30
5;Carne;5.00;20
```

2. Mostrar todos los productos del inventario siguiendo el formato del ejemplo:

```yml
ID: 1 | Nombre: Manzana | Precio: 0.50€ | Stock: 100 unidades
```

3. Añadir un nuevo producto.

El usuario debe introducir los datos y se añade al final del fichero CSV.

4. Modificar el stock de un producto dado su ID.

Permite aumentar o disminuir el Stock.

5. Elmininar un producto dado su ID.

Debe elminar la línea correspondiente del fichero CSV.

Restricciones:

- Utiliza las clases clásicas de Java (``File``, ``BufferedReader``, ``BufferedWriter``).

- El separador del CSV debe ser ``;``.

- Cada operación debe modificar el fichero real (lectura y escritura).

- Crea las clases necesarias (por ejemplo, una clase ``Producto`` para representar los datos).

<details>
<summary>Ver Solución</summary>
    <Tabs defaultValue="inventario" groupId="ejercicio-7" values={[
        {label: 'Producto.java', value: 'producto',},
        {label: 'Inventario.java', value: 'inventario',},
        {label: 'Main.java', value: 'main',},
        {label: 'productos.csv (ejemplo)', value: 'productoscsv',},
    ]}>
        <TabItem value="producto">
```java
public class Producto {
    private int id;
    private String nombre;
    private double precio;
    private int stock;

    public Producto(int id, String nombre, double precio, int stock) {
        this.id = id;
        this.nombre = nombre;
        this.precio = precio;
        this.stock = stock;
    }

    public int getId() {
        return id;
    }

    public String getNombre() {
        return nombre;
    }

    public double getPrecio() {
        return precio;
    }

    public int getStock() {
        return stock;
    }

    public void setStock(int stock) {
        this.stock = stock;
    }

    public String toCSV() {
        return id + ";" + nombre + ";" + precio + ";" + stock;
    }

    @Override
    public String toString() {
        return "ID: " + id + " | Nombre: " + nombre + " | Precio: " + precio + "€ | Stock: " + stock + " unidades";
    }
}
```
        </TabItem>
        <TabItem value="inventario">
```java
import java.io.*;
import java.util.ArrayList;
import java.util.List;

public class Inventario {
    private final String nombreFichero = "productos.csv";

    public Inventario() {
        crearFicheroInicial();
    }

    private void crearFicheroInicial() {
        File fichero = new File(nombreFichero);
        if (!fichero.exists()) {
            try (BufferedWriter bw = new BufferedWriter(new FileWriter(fichero))) {
                bw.write("1;Manzana;0.50;100");
                bw.newLine();
                bw.write("2;Leche;1.20;50");
                bw.newLine();
                bw.write("3;Pan;0.80;75");
            } catch (IOException e) {
                System.out.println("Error al crear fichero inicial: " + e.getMessage());
            }
        }
    }

    public List<Producto> cargarProductos() {
        List<Producto> productos = new ArrayList<>();

        try (BufferedReader br = new BufferedReader(new FileReader(nombreFichero))) {
            String linea;
            while ((linea = br.readLine()) != null) {
                String[] partes = linea.split(";");
                int id = Integer.parseInt(partes[0]);
                String nombre = partes[1];
                double precio = Double.parseDouble(partes[2]);
                int stock = Integer.parseInt(partes[3]);

                productos.add(new Producto(id, nombre, precio, stock));
            }
        } catch (IOException e) {
            System.out.println("Error al leer el fichero: " + e.getMessage());
        }

        return productos;
    }

    public void mostrarProductos() {
        List<Producto> productos = cargarProductos();
        System.out.println("\n--- Productos en Inventario ---");
        for (Producto p : productos) {
            System.out.println(p);
        }
    }

    public void añadirProducto(Producto producto) {
        try (BufferedWriter bw = new BufferedWriter(new FileWriter(nombreFichero, true))) {
            bw.newLine();
            bw.write(producto.toCSV());
        } catch (IOException e) {
            System.out.println("Error al añadir producto: " + e.getMessage());
        }
    }

    public void modificarStock(int id, int nuevoStock) {
        List<Producto> productos = cargarProductos();

        boolean encontrado = false;
        for (Producto p : productos) {
            if (p.getId() == id) {
                p.setStock(nuevoStock);
                encontrado = true;
                break;
            }
        }

        if (encontrado) {
            guardarProductos(productos);
            System.out.println("Stock modificado correctamente.");
        } else {
            System.out.println("Producto no encontrado.");
        }
    }

    public void eliminarProducto(int id) {
        List<Producto> productos = cargarProductos();

        boolean eliminado = productos.removeIf(p -> p.getId() == id);

        if (eliminado) {
            guardarProductos(productos);
            System.out.println("Producto eliminado correctamente.");
        } else {
            System.out.println("Producto no encontrado.");
        }
    }

    private void guardarProductos(List<Producto> productos) {
        try (BufferedWriter bw = new BufferedWriter(new FileWriter(nombreFichero))) {
            for (Producto p : productos) {
                bw.write(p.toCSV());
                bw.newLine();
            }
        } catch (IOException e) {
            System.out.println("Error al guardar productos: " + e.getMessage());
        }
    }
}
```
        </TabItem>
        <TabItem value="main">
```java
import java.util.Scanner;

public class Main {
    public static void main(String[] args) {
        Inventario inventario = new Inventario();
        Scanner sc = new Scanner(System.in);
        int opcion;

        do {
            System.out.println("\n--- Menú de Inventario ---");
            System.out.println("1. Mostrar productos");
            System.out.println("2. Añadir producto");
            System.out.println("3. Modificar stock");
            System.out.println("4. Eliminar producto");
            System.out.println("5. Salir");
            System.out.print("Seleccione una opción: ");
            opcion = sc.nextInt();
            sc.nextLine();

            switch (opcion) {
                case 1:
                    inventario.mostrarProductos();
                    break;
                case 2:
                    System.out.print("ID del producto: ");
                    int id = sc.nextInt();
                    sc.nextLine();
                    System.out.print("Nombre: ");
                    String nombre = sc.nextLine();
                    System.out.print("Precio: ");
                    double precio = sc.nextDouble();
                    System.out.print("Stock: ");
                    int stock = sc.nextInt();

                    Producto nuevo = new Producto(id, nombre, precio, stock);
                    inventario.añadirProducto(nuevo);
                    break;
                case 3:
                    System.out.print("ID del producto: ");
                    int idMod = sc.nextInt();
                    System.out.print("Nuevo stock: ");
                    int nuevoStock = sc.nextInt();
                    inventario.modificarStock(idMod, nuevoStock);
                    break;
                case 4:
                    System.out.print("ID del producto a eliminar: ");
                    int idElim = sc.nextInt();
                    inventario.eliminarProducto(idElim);
                    break;
                case 5:
                    System.out.println("Saliendo...");
                    break;
                default:
                    System.out.println("Opción no válida.");
            }
        } while (opcion != 5);
    }
}
```
        </TabItem>
        <TabItem value="productoscsv">
```csv
ID;Nombre;Precio;Stock
1;Manzana;0.50;100
2;Leche;1.20;50
3;Pan;0.80;75
4;Arroz;1.50;30
5;Carne;5.00;20
```
        </TabItem>
    </Tabs>
</details>

### Así resolvimos los ejercicios en clase:
[Soluciones clase - PDTE]